<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/starlake/blog/rss.xml" title="Quickly Build Optimized Big &amp; Fast Data Pipelines Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/starlake/blog/atom.xml" title="Quickly Build Optimized Big &amp; Fast Data Pipelines Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-S16TFWHZYT","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Quickly Build Optimized Big &amp; Fast Data Pipelines" href="/starlake/opensearch.xml"><title data-react-helmet="true">Configuration | Quickly Build Optimized Big &amp; Fast Data Pipelines</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://starlake-ai.github.io/starlake/docs/reference/configuration"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configuration | Quickly Build Optimized Big &amp; Fast Data Pipelines"><meta data-react-helmet="true" name="description" content="Comet Data Pipeline is written using Scala / Spark and is thus run using the spark-submit command."><meta data-react-helmet="true" property="og:description" content="Comet Data Pipeline is written using Scala / Spark and is thus run using the spark-submit command."><link data-react-helmet="true" rel="shortcut icon" href="/starlake/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://starlake-ai.github.io/starlake/docs/reference/configuration"><link data-react-helmet="true" rel="alternate" href="https://starlake-ai.github.io/starlake/docs/reference/configuration" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://starlake-ai.github.io/starlake/docs/reference/configuration" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://IEP5P8HN5L-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/starlake/assets/css/styles.fad5d615.css">
<link rel="preload" href="/starlake/assets/js/runtime~main.aea1e4c5.js" as="script">
<link rel="preload" href="/starlake/assets/js/main.8f579e56.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/starlake/"><img src="/starlake/img/starlake.png" alt="Starlake" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/starlake/img/starlake.png" alt="Starlake" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Starlake</b></a><a class="navbar__item navbar__link navbar__link--active" href="/starlake/docs/intro">Getting Started</a><a class="navbar__item navbar__link" href="/starlake/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/starlake-ai/starlake/releases/latest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-download-link header-icon-link" aria-label="Download"></a><a href="https://github.com/starlake-ai/starlake" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link header-icon-link" aria-label="GitHub repository"></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/starlake/docs/intro">What is it ?</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Reference</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/starlake/docs/reference/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/reference/environment">Environment</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/reference/extract">Extract</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/reference/load">Load</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/starlake/docs/reference/transform">Transform</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">HOWTO</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Examples</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cloud Specific</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CLI</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Developer Guide</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configuration</h1></header><p>Comet Data Pipeline is written using Scala / Spark and is thus run using the spark-submit command.</p><p>To run it with the default configuration, you simply launch it as follows :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SPARK_HOME/bin/spark-submit --class com.ebiznext.comet.job.Main </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">/bin/comet-spark3_2.12-VERSION-assembly.jar COMMAND </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">ARGS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>SPARK_HOME: Spark home directory</li><li>COMMAND: Any of the command described in the CLI section followed by optional arguments</li><li>ARGS: Option list of command arguments</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuration"></a>Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="applicationconf"></a>application.conf<a class="hash-link" href="#applicationconf" title="Direct link to heading">#</a></h3><p>You may also pass any Spark arguments as usual but also pass a custom <code>application.conf</code> file
using the <a href="https://github.com/lightbend/config" target="_blank" rel="noopener noreferrer">HOCON</a> syntax  that supersedes the default Comet Data Pipeline settings.
default settings are found in the <a href="https://github.com/ebiznext/comet-data-pipeline/blob/master/src/main/resources/reference.conf" target="_blank" rel="noopener noreferrer">reference.conf</a>
and <a href="https://github.com/ebiznext/comet-data-pipeline/blob/master/src/main/resources" target="_blank" rel="noopener noreferrer">reference-*.conf</a> files. In your <code>application.conf</code>file you only
need to redefine the variables you want to customize.</p><p>Some of those configurations may also be redefined through environment variables.</p><ul><li>In client mode: To pass those env vars, simply export / set them before calling spark-submmit.</li><li>In cluster mode, you need to pass them as extra driver options.</li></ul><p>Passing the <code>application.conf</code> file to the spark job use the syntax below:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">CUSTOM_OPTIONS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;--conf spark.driver.extraJavaOptions=-Dconfig.file=</span><span class="token string environment constant" style="color:rgb(130, 170, 255)">$PWD</span><span class="token string" style="color:rgb(195, 232, 141)">/application.conf&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SPARK_HOME/bin/spark-submit </span><span class="token variable" style="color:rgb(191, 199, 213)">$CUSTOM_OPTIONS</span><span class="token plain"> --class com.ebiznext.comet.job.Main </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">/bin/comet-spark3_2.12-VERSION-assembly.jar COMMAND </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">ARGS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="environment-variables"></a>Environment variables<a class="hash-link" href="#environment-variables" title="Direct link to heading">#</a></h3><ul><li><p>On Premise: To pass Comet Data Pipeline env vars in cluster mode, you&#x27;ll have to put them in the spark-defaults.conf file or pass them as arguments to your
Spark job as described in this <a href="https://stackoverflow.com/questions/37887168/how-to-pass-environment-variables-to-spark-driver-in-cluster-mode-with-spark-sub" target="_blank" rel="noopener noreferrer">article</a></p></li><li><p>On Google Cloud: To make it available for all your jobs, you need to pass them in the <code>DataprocClusterCreateOperator</code> using the <code>spark-env:</code>prefix
as described in the example below:</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    create_cluster </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> DataprocClusterCreateOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;create_dataproc_cluster&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cluster_name</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">CLUSTER_NAME</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        num_workers</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;${dataproc_cluster_size}&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        zone</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">ZONE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        region</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;${region}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        tags </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dataproc&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        storage_bucket </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dataproc-${project_id}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        image_version</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2.0.1-debian10&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        master_machine_type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">MASTER_MACHINE_TYPE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        worker_machine_type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">WORKER_MACHINE_TYPE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        service_account </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;${service_account}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        internal_ip_only </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">True</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        subnetwork_uri </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;projects/${project_id}/regions/${region}/subnetworks/${subnet}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        properties </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark-env:COMET_FS&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;gs://${my_bucket}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark-env:COMET_HIVE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;false&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark-env:COMET_GROUPED&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;false&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark-env:COMET_AUDIT_SINK_TYPE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;BigQuerySink&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the example above, the variables are available in all the tasks that will be started on this cluster.</p><p>To set variables for specific tasks only, use a syntax similar to this one:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">t1 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> dataproc_operator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">DataProcSparkOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  task_id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;my_task&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dataproc_spark_jars</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;gs://my-bucket/comet-spark3_2.12-VERSION-assembly.jar&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cluster_name</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cluster&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  main_class </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;com.ebiznext.comet.job.Main&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  arguments</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;import&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  project_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;my-project-id&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dataproc_spark_properties</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;spark.driver.extraJavaOptions&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;-DCOMET_FS=gs://${my_bucket} -DCOMET_HIVE=false -DCOMET_GROUPED=false&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dag</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuration-sections"></a>Configuration sections<a class="hash-link" href="#configuration-sections" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="filesystem"></a>Filesystem<a class="hash-link" href="#filesystem" title="Direct link to heading">#</a></h3><p>A filesystem is the location where datasets and Comet Data Pipeline metadata used for ingestion are stored.</p><ul><li>On premise this reference the folder where datasets and metadata are stored, eq.<ul><li>On a local filesystem: file://</li><li>On a HDFS: hdfs://localhost:9000</li></ul></li><li>In the cloud:<ul><li>On Google Cloud Platform: gs://my-bucket</li><li>On Microsoft Azure: abfs://<a href="mailto:my-bucket@comet.dfs.core.windows.net" target="_blank" rel="noopener noreferrer">my-bucket@comet.dfs.core.windows.net</a></li><li>On Amazon Web Service: s3a://my_bucket</li></ul></li></ul><p>By default, Comet expect metadata in the /tmp/metadata folder and will store ingested datasets in the /tmp/datasets folder.
Below is how the folders look like by default for the provided quickstart sample.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /tmp</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |-- datasets (Root folder of ingested datasets)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- accepted (Root folder of all valid records)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr (domain name as specified in the name attribute of the /tmp/metadata/hr.yml)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |   `-- sellers (Schema name as specified in the /tmp/metadata/hr.yml)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |       |-- _SUCCESS</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |       `-- part-00000-292c081b-7291-4797-b935-17bc9409b03b.snappy.parquet</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |-- customers (valid records for this schema as specified in the /tmp/metadata/sales.yml)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |   |-- _SUCCESS</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |   `-- part-00000-562501a1-34ef-4b94-b527-8e93bcbb5f89.snappy.parquet</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       `-- orders (valid records for this schema as specified in the /tmp/metadata/sales.yml)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |           |-- _SUCCESS</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |           `-- part-00000-92544093-4ae2-4a98-8df8-a5aba19a1b27.snappy.parquet</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- archive (Source files as found in the incoming folder are saved here after processing)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr (Domain name)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |   `-- sellers-2018-01-01.json</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |-- customers-2018-01-01.psv</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       `-- orders-2018-01-01.csv</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- business</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- metrics</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- discrete</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- continuous</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- frequencies</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- ingesting (Temporary folder used during ingestion by Comet)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr (One temporary subfolder / domain)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- pending (Source files are copied here from the incoming folder before processing)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr (one folder / domain)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |-- rejected (invalid records in processed datasets are stored here)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |-- hr (Domain name)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |   `-- sellers (Schema name)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |       |-- _SUCCESS</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   |       `-- part-00000-aef2dde6-af24-4e20-ad88-3e5238916e57.snappy.parquet</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |   `-- sales</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |-- customers</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |   |-- _SUCCESS</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       |   `-- part-00000-e6fa5ff9-ad29-4e5f-a5ff-549dd331fafd.snappy.parquet</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |       `-- orders</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |           |-- _SUCCESS</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   |           `-- part-00000-6f7ba5d4-960b-4ac6-a123-87a7ab2d212f.snappy.parquet</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |   `-- unresolved (Files found in the incoming folder but do not match any schema)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |       `-- hr</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    |           `-- dummy.json</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    `-- metadata (Root of metadata files)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |-- domains (all domain definition files are located in this folder)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   |-- hr.yml (One definition file / domain)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   `-- sales.yml</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        `-- assertions (All assertion definitions go here)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   |-- default.comet.yml (Predefined assertion definitions)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   `-- assertions.comet.yml (assertion definitions defined here are accessible throughout the project)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        `-- views (All views definitions go here)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   |-- default.comet.yml (Predefined view definitions)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   `-- views.comet.yml (view definitions defined here are accessible throughout the project)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        `-- types (All semantic types are defined here)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   |-- default.comet.yml (Default semantic types)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        |   `-- types.comet.yml (User defined semantic types, overwrite default ones)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        `-- jobs (All transform jobs go here)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            `-- sales-by-name.yml (Compute sales by )</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Comet Data Pipeline allows you to store datasets and metadata in two different filesystems. Thi is useful if you want to define a specific lifecycle
for your datasets.
Almost all options are customizable through environnement variables.
The main env vars are described below, you may change default settings. The exhaustive list of predefined env vars can be found in the reference.conf file.</p><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env variable</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">file-system</td><td align="left">COMET_FS</td><td align="left">file://</td><td align="left">File system where datasets will be located</td></tr><tr><td align="left">metadata-file-system</td><td align="left">COMET_METADATA_FS</td><td align="left">${file-system}</td><td align="left">File system where Comet metadata will be located</td></tr><tr><td align="left">root</td><td align="left">COMET_ROOT</td><td align="left">/tmp</td><td align="left">Root directory of the datasets and metadata files in the defined filesystem above</td></tr><tr><td align="left">tmp-dir</td><td align="left">COMET_TMPDIR</td><td align="left">When compacting data and estimating number of partitions, Comet stores intermediates files in this folder</td><td align="left">${root}&quot;/comet_tmp&quot;</td></tr><tr><td align="left">datasets</td><td align="left">COMET_DATASETS</td><td align="left">${root}&quot;/datasets&quot;</td><td align="left">Folder where datasets are located in the datasets <code>file-system</code></td></tr><tr><td align="left">metadata</td><td align="left">COMET_METADATA</td><td align="left">${root}&quot;/metadata&quot; otherwise</td><td align="left">Folder where metadata are located in the metadata <code>metadata-file-system</code></td></tr><tr><td align="left">file-system</td><td align="left">COMET_FS</td><td align="left">file://</td><td align="left">File system where datasets will be located</td></tr><tr><td align="left">area.pending</td><td align="left">COMET_AREA_PENDING</td><td align="left">pending</td><td align="left">Source files are copied here from the incoming folder before processing</td></tr><tr><td align="left">area.unresolved</td><td align="left">COMET_AREA_UNRESOLVED</td><td align="left">unresolved</td><td align="left">Files found in the incoming folder but do not match any schema</td></tr><tr><td align="left">area.archive</td><td align="left">COMET_AREA_ARCHIVE</td><td align="left">archive</td><td align="left">Source files as found in the incoming folder are saved here after processing</td></tr><tr><td align="left">area.ingesting</td><td align="left">COMET_AREA_INGESTING</td><td align="left">ingesting</td><td align="left">Temporary folder used during ingestion by Comet</td></tr><tr><td align="left">area.accepted</td><td align="left">COMET_AREA_ACCEPTED</td><td align="left">accepted</td><td align="left">root folder of all valid records</td></tr><tr><td align="left">area.rejected</td><td align="left">COMET_AREA_REJECTED</td><td align="left">rejected</td><td align="left">invalid records in processed datasets are stored here</td></tr><tr><td align="left">area.business</td><td align="left">COMET_AREA_BUSINESS</td><td align="left">business</td><td align="left">root folder for all datasets produced by autojobs</td></tr><tr><td align="left">archive</td><td align="left">COMET_ARCHIVE</td><td align="left">true</td><td align="left">Should we archive the incoming files once they are ingested</td></tr><tr><td align="left">default-write-format</td><td align="left">COMET_DEFAULT_WRITE_FORMAT</td><td align="left">parquet</td><td align="left">How accepted records are stored (parquet / orc / json / csv / avro)</td></tr><tr><td align="left">default-rejected-write-format</td><td align="left">COMET_DEFAULT_REJECTED_WRITE_FORMAT</td><td align="left">parquet</td><td align="left">How rejected records are stored (parquet / orc / json / csv / avro)</td></tr><tr><td align="left">default-audit-write-format</td><td align="left">COMET_DEFAULT_AUDIT_WRITE_FORMAT</td><td align="left">parquet</td><td align="left">How audit is stored (parquet / orc / json / csv / avro)</td></tr><tr><td align="left">hive</td><td align="left">COMET_HIVE</td><td align="left">true</td><td align="left">Should we create external Hive tables for ingested files ?</td></tr><tr><td align="left">analyze</td><td align="left">COMET_ANALYZE</td><td align="left">true</td><td align="left">Should we computed basic statistics ? (requires COMET_HIVE to be set to true)</td></tr><tr><td align="left">launcher</td><td align="left">COMET_LAUNCHER</td><td align="left">simple</td><td align="left">Which orchestrator to use ? Valid values are airflow or simple (direct call)</td></tr></tbody></table><p>Below is the default YAML file for filesystem options:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hocon"><pre tabindex="0" class="prism-code language-hocon codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">file-system = &quot;file://&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">file-system = ${?COMET_FS}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata-file-system = ${file-system}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata-file-system = ${?COMET_METADATA_FS}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root = &quot;/tmp&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">root = ${?COMET_ROOT}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">datasets = ${root}&quot;/datasets&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">datasets = ${?COMET_DATASETS}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata = ${root}&quot;/metadata&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata = ${?COMET_METADATA}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">area {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pending = &quot;pending&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pending = ${?COMET_AREA_PENDING}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  unresolved = &quot;unresolved&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  unresolved = ${?COMET_AREA_UNRESOLVED}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  archive = &quot;archive&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  archive = ${?COMET_AREA_ARCHIVE}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ingesting = &quot;ingesting&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ingesting = ${?COMET_AREA_INGESTING}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  accepted = &quot;accepted&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  accepted = ${?COMET_AREA_ACCEPTED}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rejected = &quot;rejected&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rejected = ${?COMET_AREA_REJECTED}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  business = &quot;business&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  business = ${?COMET_AREA_BUSINESS}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tmpdir = ${root}&quot;/comet_tmp&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tmpdir = ${?COMET_TMPDIR}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">archive = true</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">archive = ${?COMET_ARCHIVE}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default-write-format = parquet</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default-write-format = ${?COMET_DEFAULT_WRITE_FORMAT}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default-rejected-write-format = parquet</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default-rejected-write-format = ${?COMET_DEFAULT_REJECTED_WRITE_FORMAT}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default-audit-write-format = parquet</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default-audit-write-format = ${?COMET_DEFAULT_AUDIT_WRITE_FORMAT}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">launcher = airflow</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">launcher = simple</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">launcher = ${?COMET_LAUNCHER}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To make sure, the same schema is not ingested by two concurrent Comet processes, Comet Data Pipeline uses a file lock when necessary.</p><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env variable</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">lock.path</td><td align="left">COMET_LOCK_PATH</td><td align="left">${root}&quot;/locks&quot;</td><td align="left">Root folder where lock file is created</td></tr><tr><td align="left">lock.timeout</td><td align="left">COMET_LOCK_TIMEOUT</td><td align="left">-1</td><td align="left">How long to wait for the file lock to be available (in seconds)</td></tr></tbody></table><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hocon"><pre tabindex="0" class="prism-code language-hocon codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">lock {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  path = ${root}&quot;/locks&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  path = ${?COMET_LOCK_PATH}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  timeout = -1</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  timeout = ${?COMET_LOCK_TIMEOUT}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ingestion"></a>Ingestion<a class="hash-link" href="#ingestion" title="Direct link to heading">#</a></h3><p>When many files that have the same pattern and thus belong to the same schema, it is possible to ingest them one after the other using an ingestion policy
or ingest all of them at once.</p><p>When ingesting the files with the same schema one after the other, it is possible to use a custom ordering policy by settings the <code>COMET_LOAD_STRATEGY</code> environment variable. Currently, the following ordering policies are defined:</p><ul><li><code>com.ebiznext.comet.job.load.IngestionTimeStrategy</code> : Order the files by modification date</li><li><code>com.ebiznext.comet.job.load.IngestionNameStrategy</code> : Order  the files by name</li></ul><p>If you want to use another custom strategy, you&#x27;ll have to implement the trait below, make it available in the classpath and set the <code>COMET_LOAD_STRATEGY</code> environment variable</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package com.ebiznext.comet.job.load</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import java.time.LocalDateTime</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import org.apache.hadoop.fs.{FileSystem, Path}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trait LoadStrategy {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /** List all files in folder</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    *</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    * @param fs        FileSystem</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    * @param path      Absolute folder path</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    * @param extension Files should end with this string. To list all files, simply provide an empty string</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    * @param since     Minimum modification time of list files. To list all files, simply provide the beginning of all times</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    * @param recursive List files recursively</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    * @return List of Path</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    */</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  def list(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fs: FileSystem,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    path: Path,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    extension: String = &quot;&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    since: LocalDateTime = LocalDateTime.MIN,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    recursive: Boolean</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ): List[Path]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To ingest all the files at once, set the <code>COMET_GROUPED</code> variable to true.</p><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env variable</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">grouped</td><td align="left">COMET_GROUPED</td><td align="left">false</td><td align="left">Should files with the same schema be ingested all at once ?</td></tr><tr><td align="left">load-strategy-class</td><td align="left">COMET_LOAD_STRATEGY</td><td align="left">com.ebiznext.comet.job.load.IngestionTimeStrategy</td><td align="left">When <code>grouped</code> is false, which ingestion order strategy to use</td></tr></tbody></table><p>Below is an example of HOCON file with the default values.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hocon"><pre tabindex="0" class="prism-code language-hocon codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">load-strategy-class = &quot;com.ebiznext.comet.job.load.IngestionTimeStrategy&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">load-strategy-class = ${?COMET_LOAD_STRATEGY}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">grouped = false</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">grouped = ${?COMET_GROUPED}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The YAML file describing the schema and ingestion rules may also define a custom sink (FS / JDBC / BigQuery / Redshift ...). </p><p>In test mode, we need to sink the files to the filesystem. To enable sinking the resulting parquet file even when another sink type is desired, simply
set the <code>COMET_SINK_TO_FILE</code> environment variable to <code>true</code>.</p><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env variable</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">sink-to-file</td><td align="left">COMET_SINK_TO_FILE</td><td align="left">false</td><td align="left">Should ingested files be stored on the filesystem on only in the sink defined in the YAML file ?</td></tr></tbody></table><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hocon"><pre tabindex="0" class="prism-code language-hocon codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sink-to-file = false</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sink-to-file = ${?COMET_SINK_TO_FILE}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When <code>sink to file</code> or a filesystem sink (SinkType.FS) is requested, and you want to output the result in a single file in the csv file format, set the <code>COMET_CSV_OUTPUT</code>
environment variable to <code>true</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="validation"></a>Validation<a class="hash-link" href="#validation" title="Direct link to heading">#</a></h3><p>During ingestion, the input file is validated up to the attribute level. Three default row validators are defined:</p><ul><li>com.ebiznext.comet.job.validator.FlatRowValidator: to validate flat files, eq. DSV, Position and single level Json files.</li><li>com.ebiznext.comet.job.validator.TreeRowValidator:  used for tree like documents, eq. XML and JSON files</li><li>com.ebiznext.comet.job.validator.AcceptAllValidator: used for any document type (flat and tree like) and accept the input without any validation</li></ul><p>The validtor to use is configurable as follows:</p><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env. variable</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left">row-validator-class</td><td align="left">COMET_ROW_VALIDATOR_CLASS</td><td align="left">com.ebiznext.comet.job.validator.FlatRowValidator</td></tr><tr><td align="left">tree-validator-class</td><td align="left">COMET_TREE_VALIDATOR_CLASS</td><td align="left">com.ebiznext.comet.job.validator.TreeRowValidator</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="privacy"></a>Privacy<a class="hash-link" href="#privacy" title="Direct link to heading">#</a></h3><p>Default valid values are NONE, HIDE, MD5, SHA1, SHA256, SHA512, AES(not implemented).
Custom values may also be defined by adding a new privacy option in the application.conf.
The default reference.conf file defines the following valid privacy strategies:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly hocon"><pre tabindex="0" class="prism-code language-hocon codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">privacy {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  options = {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;none&quot;: &quot;com.ebiznext.comet.privacy.No&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;hide&quot;: &quot;com.ebiznext.comet.privacy.Hide&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;hide10X&quot;: &quot;com.ebiznext.comet.privacy.Hide(\&quot;X\&quot;,10)&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;approxLong20&quot;: &quot;com.ebiznext.comet.privacy.ApproxLong(20)&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;md5&quot;: &quot;com.ebiznext.comet.privacy.Md5&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;sha1&quot;: &quot;com.ebiznext.comet.privacy.Sha1&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;sha256&quot;: &quot;com.ebiznext.comet.privacy.Sha256&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;sha512&quot;: &quot;com.ebiznext.comet.privacy.Sha512&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;initials&quot;: &quot;com.ebiznext.comet.privacy.Initials&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the YAML file, reference, you reference the option name. This will apply the function defined in the class referenced by the option value.</p><p>Below the predefined strategies:</p><table><thead><tr><th align="left">Privacy Strategy</th><th align="left">Privacy class</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">none</td><td align="left">com.ebiznext.comet.privacy.No</td><td align="left">Return the input string itself</td></tr><tr><td align="left">hide</td><td align="left">com.ebiznext.comet.privacy.Hide(\&quot;X\&quot;, 10)</td><td align="left">Without a parameter, return the empty string. Otherwise, replace with 10 occurrences of the character &#x27;X&#x27;</td></tr><tr><td align="left">md5</td><td align="left">com.ebiznext.comet.privacy.Md5</td><td align="left">Return the md5 of the input string</td></tr><tr><td align="left">sha1</td><td align="left">com.ebiznext.comet.privacy.Sha1</td><td align="left">Return the sha1 of the input string</td></tr><tr><td align="left">sha256</td><td align="left">com.ebiznext.comet.privacy.Sha256</td><td align="left">Return the sha256 of the input string</td></tr><tr><td align="left">sha512</td><td align="left">com.ebiznext.comet.privacy.Sha512</td><td align="left">Return the sha256 of the input string</td></tr><tr><td align="left">initials</td><td align="left">com.ebiznext.comet.privacy.Initials</td><td align="left">Return the first char of each word (usually applied to user names)</td></tr></tbody></table><p>The following startegies are also defined and may be declared in the custom configuration file.</p><table><thead><tr><th align="left">Privacy class</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">com.ebiznext.comet.privacy.IPv4(8)</td><td align="left">Return the IPv4 address with the last 8 bytes masked</td></tr><tr><td align="left">com.ebiznext.comet.privacy.IPv6(8</td><td align="left">Return the IPv6 address with the last 8 bytes masked</td></tr><tr><td align="left">com.ebiznext.comet.privacy.RandomDouble</td><td align="left">Return a random double number</td></tr><tr><td align="left">com.ebiznext.comet.privacy.RandomDouble(10,20)</td><td align="left">Return a random double between 10.0 and 20.0</td></tr><tr><td align="left">com.ebiznext.comet.privacy.RandomLong</td><td align="left">Return a random long number</td></tr><tr><td align="left">com.ebiznext.comet.privacy.RandomLong(10, 20)</td><td align="left">Return a random long number between 10 and 20</td></tr><tr><td align="left">com.ebiznext.comet.privacy.RandomInt</td><td align="left">Return a random int number</td></tr><tr><td align="left">com.ebiznext.comet.privacy.RandomInt(10, 20)</td><td align="left">Return a random int number between 10 and 20</td></tr><tr><td align="left">com.ebiznext.comet.privacy.ApproxDouble(70)</td><td align="left">Return a double value with a variation up to 70% applied to the input value</td></tr><tr><td align="left">com.ebiznext.comet.privacy.ApproxLong(70)</td><td align="left">Return a double long with a variation up to 70% applied to the input value</td></tr><tr><td align="left">com.ebiznext.comet.privacy.Mask(\&quot;*\&quot;, 4, 1, 3)</td><td align="left">Partially mask the input value with 4 occurrences of the &#x27;*&#x27; character, 1 on the left side and 3 on the right side.</td></tr></tbody></table><p>Any new privacy strategy should implement the following trait :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scala"><pre tabindex="0" class="prism-code language-scala codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/** @param s: String  =&gt; Input string to encrypt</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  * @param colMap : Map[String, Option[String]] =&gt; Map of all the attributes and their corresponding values</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  * @param params: List[Any]  =&gt; Parameters passed to the algorithm as defined in the conf file.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  *                               Parameter starting with &#x27;&quot;&#x27; is converted to a string</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  *                               Parameter containing a &#x27;.&#x27; is converted to a double</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  *                               Parameter equals to true of false is converted a boolean</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  *                               Anything else is converted to an int</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  * @return The encrypted string</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  */</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="sinks"></a>Sinks<a class="hash-link" href="#sinks" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="bigquery-sink"></a>BigQuery Sink<a class="hash-link" href="#bigquery-sink" title="Direct link to heading">#</a></h4><p>When type field is set to <code>BigQuerySink</code></p><table><thead><tr><th align="left">Property</th><th align="left">Type</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">Optional String</td><td align="left">None</td><td align="left"></td></tr><tr><td align="left">location</td><td align="left">String</td><td align="left">EU</td><td align="left">Database location (EU, US, ...)</td></tr><tr><td align="left">timestamp</td><td align="left">String</td><td align="left">None</td><td align="left">The timestamp column to use for table partitioning if any. No partitioning by default</td></tr><tr><td align="left">clustering</td><td align="left">List</td><td align="left">None</td><td align="left">List of ordered columns to use for table clustering</td></tr><tr><td align="left">days</td><td align="left">Int</td><td align="left">None</td><td align="left">Number of days before this table is set as expired and deleted. Never by default.</td></tr><tr><td align="left">requirePartitionFilter</td><td align="left">Boolean</td><td align="left">false</td><td align="left">Should be require a partition filter on every request ? No by default.</td></tr><tr><td align="left">options</td><td align="left">Map</td><td align="left">None</td><td align="left">Spark or BigQuery (depend on the selected engine) options to be set on the BigQuery connection</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="elasticsearch-sink"></a>Elasticsearch Sink<a class="hash-link" href="#elasticsearch-sink" title="Direct link to heading">#</a></h4><p>When type field is set to <code>EsSink</code></p><table><thead><tr><th align="left">Property</th><th align="left">Type</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">Optional String</td><td align="left">None</td><td align="left"></td></tr><tr><td align="left">id</td><td align="left">String</td><td align="left">None</td><td align="left">Attribute to use as id of the document. Generated by Elasticseach if not specified.</td></tr><tr><td align="left">timestamp</td><td align="left">String</td><td align="left">None</td><td align="left">Timestamp field format as expected by Elasticsearch (&quot;{beginTs|yyyy.MM.dd}&quot; for example).</td></tr><tr><td align="left">options</td><td align="left">Map</td><td align="left">None</td><td align="left">Elasticsearch options to be set on the ES connection</td></tr></tbody></table><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="filesystem-sink"></a>Filesystem Sink<a class="hash-link" href="#filesystem-sink" title="Direct link to heading">#</a></h4><p>When type field is set to <code>FsSink</code>. FsSink est the default sink type when ingesting data.
The file where data is saved is computed using the domain and schema name. See <a href="/starlake/docs/howto/load">Load</a> and <a href="/starlake/docs/howto/transform">Transform</a></p><table><thead><tr><th align="left">Property</th><th align="left">Type</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">Optional String</td><td align="left">None</td><td align="left"></td></tr><tr><td align="left">connection</td><td align="left">String</td><td align="left">None</td><td align="left">JDBC Connection String</td></tr><tr><td align="left">options</td><td align="left">Map</td><td align="left">None</td><td align="left"><a href="https://spark.apache.org/docs/latest/sql-data-sources-jdbc.html" target="_blank" rel="noopener noreferrer">JDBC Options</a></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="audit--metrics--assertions"></a>Audit / Metrics / Assertions<a class="hash-link" href="#audit--metrics--assertions" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="elasticsearch"></a>Elasticsearch<a class="hash-link" href="#elasticsearch" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="spark"></a>Spark<a class="hash-link" href="#spark" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="kafka"></a>Kafka<a class="hash-link" href="#kafka" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="jdbc"></a>JDBC<a class="hash-link" href="#jdbc" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="µ-service"></a>µ-service<a class="hash-link" href="#µ-service" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="airflow"></a>Airflow<a class="hash-link" href="#airflow" title="Direct link to heading">#</a></h3><table><thead><tr><th align="left">HOCON Variable</th><th align="left">Env variable</th><th align="left">Default Value</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"></td><td align="left">AIRFLOW_ENDPOINT</td><td align="left">Airflow endpoint. Used when COMET_LAUNCHER is set to airflow</td><td align="left"><a href="http://127.0.0.1:8080/api/experimental" target="_blank" rel="noopener noreferrer">http://127.0.0.1:8080/api/experimental</a></td></tr></tbody></table><table><thead><tr><th>Env. Var</th><th>Description</th><th>Default value</th></tr></thead></table><blockquote><p>📝 <strong>When running Spark on YARN in cluster mode,
environment variables need to be set using the syntax spark.yarn.appMasterEnv.[EnvironmentVariableName]</strong></p></blockquote><blockquote><p>📝 <strong>When running Dataproc on GCP, environment variables need to be set
in the DataprocClusterCreateOperator in the properties attributes
using the syntax &quot;spark-env:[EnvironmentVariableName]&quot;:&quot;[Value]&quot;</strong></p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="airflow-dags"></a>Airflow DAGs<a class="hash-link" href="#airflow-dags" title="Direct link to heading">#</a></h2><p>Comet Data Pipeline comes with native  Airflow support.
Below are DAG definitions for each of the three ingestion steps on an kerberized cluster.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="import-dag"></a>Import DAG<a class="hash-link" href="#import-dag" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> DAG</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">bash_operator </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> BashOperator</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default_args </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;owner&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;airflow&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;depends_on_past&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;start_date&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2018</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;me@here.com&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_failure&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_retry&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retries&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retry_delay&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">minutes</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dag </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> DAG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_import&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">max_active_runs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> catchup</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> default_args</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">default_args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schedule_interval</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*/1 * * * *&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">COMET_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> &quot;spark2</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">submit \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">keytab </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">keytabs</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">importhdfs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">keytab \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">principal importhdfs@MY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">BIGDATA \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jars</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">packages</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">\&quot;\&quot; \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">master yarn \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">deploy</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mode client </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">home</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">airflow</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">program</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">comet</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">assembly</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jar&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CometImport </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BashOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_import&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bash_command</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> COMET_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27; import&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_DATASETS&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_METADATA&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/metadata&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_AREA_ACCEPTED&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;working&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_AREA_PENDING&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;staging&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_ARCHIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_LAUNCHER&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;airflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_HIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_ANALYZE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dag</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="watch-dag"></a>Watch DAG<a class="hash-link" href="#watch-dag" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> os</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> DAG</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">bash_operator </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> BashOperator</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> datetime </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> timedelta</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">slack_operator </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> SlackAPIPostOperator</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default_args </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;owner&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;airflow&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;depends_on_past&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;start_date&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2018</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;me@here.com&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_failure&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_retry&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retries&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retry_delay&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">minutes</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &#x27;queue&#x27;: &#x27;bash_queue&#x27;,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &#x27;pool&#x27;: &#x27;backfill&#x27;,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &#x27;priority_weight&#x27;: 10,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># &#x27;end_date&#x27;: datetime(2016, 1, 1),</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dag </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> DAG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_watcher&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">max_active_runs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> catchup</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> default_args</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">default_args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schedule_interval</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*/1 * * * *&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">slack_task</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    slack_alert </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SlackAPIPostOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;slack_alert&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        channel</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#airflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        token</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xoxp-64071012534-475450904118-524897638692-f9a90d49fd7fb312a574b4570d557b9a&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        text </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        username </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;airflow&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> slack_alert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">COMET_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> &quot;spark2</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">submit \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">keytab </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">keytabs</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">importhdfs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">keytab \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">principal importhdfs@MY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">BIGDATA \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jars</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">packages</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">\&quot;\&quot; \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">master yarn \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">deploy</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mode client </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">home</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">airflow</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">program</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">comet</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">assembly</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jar&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">COMET_DOMAIN </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_DOMAIN&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CometWatch </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BashOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_watcher&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bash_command</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> COMET_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27; watch &#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> COMET_DOMAIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#on_failure_callback=slack_task(&quot;:red_circle: Task Comet Watch Failed&quot;),</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#on_success_callback=slack_task(&quot;:ok_hand: Task Comet Watch Success&quot;),</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;AIRFLOW_ENDPOINT&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https://airflow.my.server.com/api/experimental&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_DATASETS&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_METADATA&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/metadata&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_AREA_ACCEPTED&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;working&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_AREA_PENDING&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;staging&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_ARCHIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_LAUNCHER&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;airflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_HIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_ANALYZE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dag</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ingestion-dag"></a>Ingestion DAG<a class="hash-link" href="#ingestion-dag" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><pre tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> DAG</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">bash_operator </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> BashOperator</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> datetime </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> timedelta</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> airflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">operators</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">slack_operator </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> SlackAPIPostOperator</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">default_args </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;owner&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;airflow&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;depends_on_past&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;start_date&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2018</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;me@here.com&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_failure&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;email_on_retry&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retries&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;retry_delay&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">minutes</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dag </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> DAG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_ingest&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">max_active_runs</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> catchup</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> default_args</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">default_args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schedule_interval </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">None</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">slack_task</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    slack_alert </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SlackAPIPostOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;slack_alert&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        channel</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#airflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        token</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xoxp-64071012534-475450904118-524897638692-f9a90d49fd7fb312a574b4570d557b9a&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        text </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        username </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;airflow&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> slack_alert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">COMET_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> &quot;spark2</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">submit \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">keytab </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">etc</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">keytabs</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">importhdfs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">keytab \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">principal importhdfs@MY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">BIGDATA \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jars</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">packages</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">\&quot;\&quot; \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">yarn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">appMasterEnv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">COMET_METADATA</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">project</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">metadata \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">yarn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">appMasterEnv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">COMET_ACCEPTED</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">working \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">conf spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">yarn</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">appMasterEnv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">COMET_DATASETS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">project</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">data \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">master yarn \</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">deploy</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">mode cluster </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">home</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">airflow</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">program</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">comet</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">assembly</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">jar&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">templated_command </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> COMET_SPARK_CMD </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token triple-quoted-string string" style="color:rgb(195, 232, 141)">&quot;&quot;&quot; {{ dag_run.conf[&#x27;command&#x27;] }}&quot;&quot;&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CometIngest </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> BashOperator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    task_id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;comet_ingest&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bash_command</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">templated_command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#on_failure_callback=slack_task(&quot;:red_circle: Task Comet Ingest Failed: &quot;),</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#on_success_callback=slack_task(&quot;:ok_hand: Task Comet Ingest Success: &quot;),</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    env</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_DATASETS&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/data&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_METADATA&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/project/metadata&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_AREA_ACCEPTED&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;working&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_AREA_PENDING&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;staging&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_ARCHIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_LAUNCHER&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;airflow&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_HIVE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;COMET_ANALYZE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dag</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">dag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/starlake-ai/starlake/edit/master/docs/docs/reference/configuration.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/starlake/docs/userguide/sample"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Example</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/starlake/docs/reference/environment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Environment »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuration" class="table-of-contents__link">Configuration</a><ul><li><a href="#applicationconf" class="table-of-contents__link">application.conf</a></li><li><a href="#environment-variables" class="table-of-contents__link">Environment variables</a></li></ul></li><li><a href="#configuration-sections" class="table-of-contents__link">Configuration sections</a><ul><li><a href="#filesystem" class="table-of-contents__link">Filesystem</a></li><li><a href="#ingestion" class="table-of-contents__link">Ingestion</a></li><li><a href="#validation" class="table-of-contents__link">Validation</a></li><li><a href="#privacy" class="table-of-contents__link">Privacy</a></li><li><a href="#sinks" class="table-of-contents__link">Sinks</a></li><li><a href="#audit--metrics--assertions" class="table-of-contents__link">Audit / Metrics / Assertions</a></li><li><a href="#elasticsearch" class="table-of-contents__link">Elasticsearch</a></li><li><a href="#spark" class="table-of-contents__link">Spark</a></li><li><a href="#kafka" class="table-of-contents__link">Kafka</a></li><li><a href="#jdbc" class="table-of-contents__link">JDBC</a></li><li><a href="#µ-service" class="table-of-contents__link">µ-service</a></li><li><a href="#airflow" class="table-of-contents__link">Airflow</a></li></ul></li><li><a href="#airflow-dags" class="table-of-contents__link">Airflow DAGs</a><ul><li><a href="#import-dag" class="table-of-contents__link">Import DAG</a></li><li><a href="#watch-dag" class="table-of-contents__link">Watch DAG</a></li><li><a href="#ingestion-dag" class="table-of-contents__link">Ingestion DAG</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/starlake/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/starlake" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitter.im/starlake/community" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Gitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/starlake-ai" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/starlake/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/starlake-ai/starlake" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with Docusaurus.</div></div></div></footer></div>
<script src="/starlake/assets/js/runtime~main.aea1e4c5.js"></script>
<script src="/starlake/assets/js/main.8f579e56.js"></script>
</body>
</html>